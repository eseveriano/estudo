<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vejo Vagas :</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f0f8f5;
            display: flex;
            min-height: 100vh;
            margin: 0;
        }

        .sidebar {
            background-color: #bfbfbf;
            color: white;
            width: 250px; /* Largura do menu lateral */
            transition: width 0.3s;
            overflow: hidden;
            position: fixed; /* Fixa o menu lateral */
            height: 100%;
            z-index: 1000;
        }

        .sidebar.expanded {
            width: 250px; /* Largura expandida */
        }

        .sidebar.collapsed {
            width: 0; /* Largura colapsada */
            padding: 0; /* Remove padding quando colapsado */
        }

        .sidebar nav {
            margin-top: 50px; /* Espaçamento de 30px no topo dos links */
        }

        .sidebar .nav-link {
            color: white;
        }

        .sidebar .nav-link:hover {
            background-color: #218838;
        }

        .content {
            margin-left: 250px; /* Margem esquerda igual à largura do menu */
            flex-grow: 1;
            transition: margin-left 0.3s;
        }

        .content.collapsed {
            margin-left: 0; /* Margem quando o menu está colapsado */
        }

        .form-container {
            background-color: #e9f7ef;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 20px; /* Espaço acima do formulário */
        }

        .btn-green {
            background-color: #28a745;
            color: white;
        }

        .btn-green:hover {
            background-color: #218838;
        }

        .card-custom {
            border: none;
            background-color: #d4edda;
            color: #155724;
        }

        .logo {
            max-width: 150px; /* Tamanho da logo */
            display: block;
            margin: 20px auto; /* Centraliza a logo */
        }

        /* Botão fixo para abrir/fechar o menu */
        #toggleButton {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 2000; /* Garante que o botão fique acima de outros elementos */
        }
        
        #portarias-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
    </style>
</head>
<body>

    <!-- Botão fixo para alternar o menu -->
    <button class="btn btn-dark" id="toggleButton">☰</button>

    <!-- Menu Lateral -->
    <div class="sidebar collapsed" id="sidebar">
        <nav class="nav flex-column">
            <a class="nav-link active" href="index.html">Início</a>
            <a class="nav-link" href="index.html">Sobre</a>
            <a class="nav-link" href="nomeacoes.html">Nomeações </a>
            <a class="nav-link" href="index.html">Ranking pós-prova</a>
        </nav>
    </div>

    <div class="content collapsed" id="content">
        <div class="text-center">
            <img src="logo-removebg-preview.png" alt="Logo" class="logo">
        </div>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-6 col-md-8 col-sm-10">
                    <div class="form-container text-center">
                        <h2 class="mb-4">Buscar Nomeações</h2>
                        <form id="searchForm">
                            <div class="mb-3">
                                <label for="name" class="form-label">Nome:</label>
                                <input type="text" class="form-control" id="name" name="name" >
                            </div>
                            <div class="mb-3">
                                <label for="date" class="form-label">Data:</label>
                                <input type="date" class="form-control" id="date" name="date" required>
                            </div>
                            <button type="submit" class="btn btn-green btn-block">Pesquisar</button>
                        </form>
                    </div>

                    <div class="card mt-4 card-custom" id="resultCard" style="display: none;">
                        <div class="card-body">
                            <h4 class="card-title">Nomeações do Dia</h4>
                            <!-- <p class="card-text"><strong>Nome:</strong> <span id="resultName"></span></p> -->
                            <p class="card-text"><strong>Data:</strong> <span id="resultDate"></span></p>
                        </div>
                    </div>

                    <div id="portarias-container"></div>
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center" id="pagination"></ul>
                    </nav>

                    <!-- Modal -->
                    <div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-fullscreen">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="modalTitle">Detalhes da Nomeação</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body" id="modalBody">
                                    <p>Conteúdo da nomeação vai aqui...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies (Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        let currentPage = 1;
const totalPages = 11;




function loadPage(page) {
    const tipo_dou = "DO2";
    const dateInput = document.getElementById('date').value;
    const [ano, mes, dia] = dateInput.split('-');

    const formattedDate = `${dia}-${mes}-${ano}`;
    $('#portarias-container').empty();

    $.getJSON(`https://vejovagas.com.br/nomeacoes/${formattedDate}/${page}.json`, function(data) {
        console.log('Dados recebidos da API:', data);
        let html = '';
        data.forEach(item => {
            console.log('Item atual:', item);
            // Escape de caracteres especiais e codificação em Base64
            const escapedItem = btoa(JSON.stringify(item));
            
            const titulo = escapeHtml(String(item.titulo || ''));
            const texto = escapeHtml(String(item.texto || '').substring(0, 200));
            const assinatura = escapeHtml(String(item.assinatura || ''));
            
            html += `
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title"><b>${titulo}</b></h5>
                        <p class="card-text">${texto}...</p>
                        <p class="card-text"><small class="text-muted">Assinatura: ${assinatura}</small></p>
                        <button class="btn btn-primary" onclick="openModal('${escapedItem}')">Ver mais</button>
                    </div>
                </div>
            `;
        });
        $('#portarias-container').html(html);
        updatePagination(page);
    });
}

// Função auxiliar para escapar HTML
function escapeHtml(unsafe) {
    if (typeof unsafe !== 'string') {
        console.warn('escapeHtml recebeu um valor não-string:', unsafe);
        return '';
    }
    return unsafe
         .replace(/&/g, "&amp;")
         .replace(/</g, "&lt;")
         .replace(/>/g, "&gt;")
         .replace(/"/g, "&quot;")
         .replace(/'/g, "&#039;");
}

function openModal(encodedItemString) {
    try {
        const decodedItemString = atob(encodedItemString);
        console.log('String decodificada:', decodedItemString);
        const item = JSON.parse(decodedItemString);
        if (item && item.titulo && item.texto && item.assinatura) {
            $('#modalTitle').text(String(item.titulo));
            $('#modalBody').html(`
                <p>${String(item.texto)}</p>
                <p><small class="text-muted">Assinatura: ${String(item.assinatura)}</small></p>
            `);
            $('#detailsModal').modal('show');
        } else {
            console.error('Item inválido:', item);
        }
    } catch (error) {
        console.error('Erro ao parsear o item:', error);
        console.log('String codificada recebida:', encodedItemString);
    }
}





function updatePagination(currentPage) {
    let paginationHtml = '';
    for (let i = 1; i <= totalPages; i++) {
        if (i === currentPage) {
            paginationHtml += `<li class="page-item active"><a class="page-link" href="#">${i}</a></li>`;
        } else {
            paginationHtml += `<li class="page-item"><a class="page-link" href="#" onclick="loadPage(${i}); event.preventDefault();">${i}</a></li>`;
        }
    }
    $('#pagination').html(paginationHtml);
}

$(document).ready(function() {
    loadPage(1); // Carrega a primeira página ao iniciar
});



        document.getElementById('searchForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Evita o envio do formulário

    const name = document.getElementById('name').value;
    const date = document.getElementById('date').value; // Data selecionada pelo usuário

    console.log("Data selecionada:", date); // Log da data selecionada

    // Formatação da data conforme especificado
    const tipo_dou = "DO2";
    const dataObj = new Date(date);
    
    const dia = dataObj.getUTCDate().toString().padStart(2, '0');
    const mes = (dataObj.getUTCMonth() + 1).toString().padStart(2, '0');
    const ano = dataObj.getUTCFullYear();

    console.log("Dia:", dia, "Mês:", mes, "Ano:", ano); // Log dos valores de dia, mês e ano

    const data_formatada_dou2 = `${tipo_dou}_${dia}_${mes}_${ano}`;

    // Preenche o card com os dados da pesquisa
    // document.getElementById('resultName').innerText = name;
    document.getElementById('resultDate').innerText = `${dia}/${mes}/${ano}`;
    document.getElementById('resultCard').style.display = 'block';

    // Carrega a primeira página de resultados com base na data formatada
    loadPage(1, data_formatada_dou2);
});

        document.getElementById('toggleButton').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const content = document.getElementById('content');
            sidebar.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
        });
    </script>





<script>
    // Função para formatar a data como YYYY-MM-DD
    function formatDate(date) {
        var d = new Date(date),
            month = '' + (d.getMonth() + 1),
            day = '' + d.getDate(),
            year = d.getFullYear();

        if (month.length < 2) 
            month = '0' + month;
        if (day.length < 2) 
            day = '0' + day;

        return [year, month, day].join('-');
    }

    // Definir a data atual como valor padrão
    document.addEventListener('DOMContentLoaded', function() {
        var today = new Date();
        var formattedDate = formatDate(today);
        document.getElementById('date').value = formattedDate;
    });
</script>
</body>
</html>
